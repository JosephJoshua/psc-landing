---
import { Icon } from 'astro-icon';
import AppButton from './app-button.astro';
---

<AppButton id="theme-switcher" class="origin-[right_center]" title="Toggle theme">
  <div id="icon-theme-light">
    <Icon aria-hidden="true" name="theme/light" class="h-8" />
    <span class="sr-only">Gunakan tema terang</span>
  </div>

  <div id="icon-theme-dark" class="hidden">
    <Icon aria-hidden="true" name="theme/dark" class="h-8" />
    <span class="sr-only">Gunakan tema gelap</span>
  </div>
</AppButton>

<script>
  import invariant from 'tiny-invariant';

  const themes = ['light', 'dark'];
  const button = document.querySelector('#theme-switcher');
  invariant(button, 'button should not be null');

  const getThemeCurrent = () => document.documentElement.dataset.theme;
  const getThemeNext = () => {
    const themeCurrent = getThemeCurrent();
    invariant(themeCurrent, 'themeCurrent should not be undefined');
    const indexThemeCurrent = themes.indexOf(themeCurrent);
    return themes[(indexThemeCurrent + 1) % themes.length];
  };

  const updateIcon = () => {
    const themeCurrent = getThemeCurrent();
    document.querySelector(`#icon-theme-${themeCurrent}`)?.classList.add('hidden');
    const themeNext = getThemeNext();
    document.querySelector(`#icon-theme-${themeNext}`)?.classList.remove('hidden');
  };

  button.addEventListener('click', () => {
    const themeNext = getThemeNext();
    document.documentElement.dataset.theme = themeNext;
    localStorage.setItem('theme', themeNext);
    updateIcon();
  });

  updateIcon();
</script>
